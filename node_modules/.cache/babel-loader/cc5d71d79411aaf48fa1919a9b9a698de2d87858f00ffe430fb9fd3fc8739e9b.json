{"ast":null,"code":"import axios from 'axios';\nconst BASE = process.env.REACT_APP_OWM_BASE || 'https://api.openweathermap.org';\nconst KEY = process.env.REACT_APP_OWM_API_KEY;\nconst POLL_TTL_MS = parseInt(process.env.REACT_APP_POLL_INTERVAL_MS || '60000', 10);\nconst CACHE_TTL = POLL_TTL_MS;\nconst cache = new Map();\nlet lastCallTs = 0;\nconst MIN_INTERVAL_MS = 200;\nasync function guardedGet(url, params = {}) {\n  const now = Date.now();\n  if (now - lastCallTs < MIN_INTERVAL_MS) {\n    await new Promise(r => setTimeout(r, MIN_INTERVAL_MS - (now - lastCallTs)));\n  }\n  lastCallTs = Date.now();\n  const resp = await axios.get(url, {\n    params\n  });\n  return resp.data;\n}\nfunction cacheKeyOneCall(lat, lon, units) {\n  return `onecall:${lat}:${lon}:${units}`;\n}\nconst weatherApi = {\n  async getOneCall({\n    lat,\n    lon,\n    units = 'metric',\n    exclude = ''\n  }) {\n    if (!KEY) throw new Error('Missing REACT_APP_OWM_API_KEY in .env.local');\n    const key = cacheKeyOneCall(lat, lon, units);\n    const entry = cache.get(key);\n    if (entry && Date.now() - entry.ts < CACHE_TTL) return entry.data;\n    const url = `${BASE}/data/3.0/onecall`;\n    const params = {\n      lat,\n      lon,\n      units,\n      exclude,\n      appid: KEY\n    };\n    const data = await guardedGet(url, params);\n    cache.set(key, {\n      data,\n      ts: Date.now()\n    });\n    return data;\n  },\n  async geocodeCity(q, limit = 5) {\n    if (!KEY) throw new Error('Missing REACT_APP_OWM_API_KEY in .env.local');\n    const key = `geocode:${q}:${limit}`;\n    const entry = cache.get(key);\n    if (entry && Date.now() - entry.ts < 300000) return entry.data;\n    const url = `${BASE}/geo/1.0/direct`;\n    const params = {\n      q,\n      limit,\n      appid: KEY\n    };\n    const data = await guardedGet(url, params);\n    cache.set(key, {\n      data,\n      ts: Date.now()\n    });\n    return data;\n  }\n};\nexport default weatherApi;","map":{"version":3,"names":["axios","BASE","process","env","REACT_APP_OWM_BASE","KEY","REACT_APP_OWM_API_KEY","POLL_TTL_MS","parseInt","REACT_APP_POLL_INTERVAL_MS","CACHE_TTL","cache","Map","lastCallTs","MIN_INTERVAL_MS","guardedGet","url","params","now","Date","Promise","r","setTimeout","resp","get","data","cacheKeyOneCall","lat","lon","units","weatherApi","getOneCall","exclude","Error","key","entry","ts","appid","set","geocodeCity","q","limit"],"sources":["C:/Users/DELL/Downloads/weather-dashboard/src/api/weatherApi.js"],"sourcesContent":["import axios from 'axios';\nconst BASE = process.env.REACT_APP_OWM_BASE || 'https://api.openweathermap.org';\nconst KEY = process.env.REACT_APP_OWM_API_KEY;\nconst POLL_TTL_MS = parseInt(process.env.REACT_APP_POLL_INTERVAL_MS || '60000', 10);\nconst CACHE_TTL = POLL_TTL_MS;\nconst cache = new Map();\nlet lastCallTs = 0;\nconst MIN_INTERVAL_MS = 200;\n\nasync function guardedGet(url, params = {}) {\n  const now = Date.now();\n  if (now - lastCallTs < MIN_INTERVAL_MS) {\n    await new Promise(r => setTimeout(r, MIN_INTERVAL_MS - (now - lastCallTs)));\n  }\n  lastCallTs = Date.now();\n  const resp = await axios.get(url, { params });\n  return resp.data;\n}\n\nfunction cacheKeyOneCall(lat, lon, units) {\n  return `onecall:${lat}:${lon}:${units}`;\n}\n\nconst weatherApi = {\n  async getOneCall({ lat, lon, units = 'metric', exclude = '' }) {\n    if (!KEY) throw new Error('Missing REACT_APP_OWM_API_KEY in .env.local');\n    const key = cacheKeyOneCall(lat, lon, units);\n    const entry = cache.get(key);\n    if (entry && (Date.now() - entry.ts) < CACHE_TTL) return entry.data;\n    const url = `${BASE}/data/3.0/onecall`;\n    const params = { lat, lon, units, exclude, appid: KEY };\n    const data = await guardedGet(url, params);\n    cache.set(key, { data, ts: Date.now() });\n    return data;\n  },\n  async geocodeCity(q, limit = 5) {\n    if (!KEY) throw new Error('Missing REACT_APP_OWM_API_KEY in .env.local');\n    const key = `geocode:${q}:${limit}`;\n    const entry = cache.get(key);\n    if (entry && (Date.now() - entry.ts) < 300000) return entry.data;\n    const url = `${BASE}/geo/1.0/direct`;\n    const params = { q, limit, appid: KEY };\n    const data = await guardedGet(url, params);\n    cache.set(key, { data, ts: Date.now() });\n    return data;\n  }\n};\nexport default weatherApi;\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,MAAMC,IAAI,GAAGC,OAAO,CAACC,GAAG,CAACC,kBAAkB,IAAI,gCAAgC;AAC/E,MAAMC,GAAG,GAAGH,OAAO,CAACC,GAAG,CAACG,qBAAqB;AAC7C,MAAMC,WAAW,GAAGC,QAAQ,CAACN,OAAO,CAACC,GAAG,CAACM,0BAA0B,IAAI,OAAO,EAAE,EAAE,CAAC;AACnF,MAAMC,SAAS,GAAGH,WAAW;AAC7B,MAAMI,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC;AACvB,IAAIC,UAAU,GAAG,CAAC;AAClB,MAAMC,eAAe,GAAG,GAAG;AAE3B,eAAeC,UAAUA,CAACC,GAAG,EAAEC,MAAM,GAAG,CAAC,CAAC,EAAE;EAC1C,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;EACtB,IAAIA,GAAG,GAAGL,UAAU,GAAGC,eAAe,EAAE;IACtC,MAAM,IAAIM,OAAO,CAACC,CAAC,IAAIC,UAAU,CAACD,CAAC,EAAEP,eAAe,IAAII,GAAG,GAAGL,UAAU,CAAC,CAAC,CAAC;EAC7E;EACAA,UAAU,GAAGM,IAAI,CAACD,GAAG,CAAC,CAAC;EACvB,MAAMK,IAAI,GAAG,MAAMvB,KAAK,CAACwB,GAAG,CAACR,GAAG,EAAE;IAAEC;EAAO,CAAC,CAAC;EAC7C,OAAOM,IAAI,CAACE,IAAI;AAClB;AAEA,SAASC,eAAeA,CAACC,GAAG,EAAEC,GAAG,EAAEC,KAAK,EAAE;EACxC,OAAO,WAAWF,GAAG,IAAIC,GAAG,IAAIC,KAAK,EAAE;AACzC;AAEA,MAAMC,UAAU,GAAG;EACjB,MAAMC,UAAUA,CAAC;IAAEJ,GAAG;IAAEC,GAAG;IAAEC,KAAK,GAAG,QAAQ;IAAEG,OAAO,GAAG;EAAG,CAAC,EAAE;IAC7D,IAAI,CAAC3B,GAAG,EAAE,MAAM,IAAI4B,KAAK,CAAC,6CAA6C,CAAC;IACxE,MAAMC,GAAG,GAAGR,eAAe,CAACC,GAAG,EAAEC,GAAG,EAAEC,KAAK,CAAC;IAC5C,MAAMM,KAAK,GAAGxB,KAAK,CAACa,GAAG,CAACU,GAAG,CAAC;IAC5B,IAAIC,KAAK,IAAKhB,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGiB,KAAK,CAACC,EAAE,GAAI1B,SAAS,EAAE,OAAOyB,KAAK,CAACV,IAAI;IACnE,MAAMT,GAAG,GAAG,GAAGf,IAAI,mBAAmB;IACtC,MAAMgB,MAAM,GAAG;MAAEU,GAAG;MAAEC,GAAG;MAAEC,KAAK;MAAEG,OAAO;MAAEK,KAAK,EAAEhC;IAAI,CAAC;IACvD,MAAMoB,IAAI,GAAG,MAAMV,UAAU,CAACC,GAAG,EAAEC,MAAM,CAAC;IAC1CN,KAAK,CAAC2B,GAAG,CAACJ,GAAG,EAAE;MAAET,IAAI;MAAEW,EAAE,EAAEjB,IAAI,CAACD,GAAG,CAAC;IAAE,CAAC,CAAC;IACxC,OAAOO,IAAI;EACb,CAAC;EACD,MAAMc,WAAWA,CAACC,CAAC,EAAEC,KAAK,GAAG,CAAC,EAAE;IAC9B,IAAI,CAACpC,GAAG,EAAE,MAAM,IAAI4B,KAAK,CAAC,6CAA6C,CAAC;IACxE,MAAMC,GAAG,GAAG,WAAWM,CAAC,IAAIC,KAAK,EAAE;IACnC,MAAMN,KAAK,GAAGxB,KAAK,CAACa,GAAG,CAACU,GAAG,CAAC;IAC5B,IAAIC,KAAK,IAAKhB,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGiB,KAAK,CAACC,EAAE,GAAI,MAAM,EAAE,OAAOD,KAAK,CAACV,IAAI;IAChE,MAAMT,GAAG,GAAG,GAAGf,IAAI,iBAAiB;IACpC,MAAMgB,MAAM,GAAG;MAAEuB,CAAC;MAAEC,KAAK;MAAEJ,KAAK,EAAEhC;IAAI,CAAC;IACvC,MAAMoB,IAAI,GAAG,MAAMV,UAAU,CAACC,GAAG,EAAEC,MAAM,CAAC;IAC1CN,KAAK,CAAC2B,GAAG,CAACJ,GAAG,EAAE;MAAET,IAAI;MAAEW,EAAE,EAAEjB,IAAI,CAACD,GAAG,CAAC;IAAE,CAAC,CAAC;IACxC,OAAOO,IAAI;EACb;AACF,CAAC;AACD,eAAeK,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}